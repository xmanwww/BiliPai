# 视频详情页功能增强 - 需求文档

## 概述

在视频详情页增强交互功能，包括视频简介展示、点赞、投币和一键三连功能，让用户能够更方便地与视频内容互动，提升用户体验和使用便捷性。

---

## 需求列表

### 1. 视频简介展示

**用户故事**：作为用户，我想要查看视频的完整简介，以便了解视频的详细内容和相关信息。

**验收标准**：

- **AC 1.1**：当视频详情页加载成功时，系统**应该**在视频标题下方显示视频简介区域
- **AC 1.2**：如果简介内容超过3行，系统**应该**默认收起并显示"展开"按钮
- **AC 1.3**：当用户点击"展开"按钮时，系统**应该**显示完整简介内容，并将按钮文字变为"收起"
- **AC 1.4**：如果视频没有简介，系统**应该**显示"暂无简介"提示文字
- **AC 1.5**：当简介包含链接时，系统**应该**将链接渲染为可点击样式

---

### 2. 点赞功能

**用户故事**：作为用户，我想要给喜欢的视频点赞，以便表达我对内容的认可。

**验收标准**：

- **AC 2.1**：当用户已登录时，系统**应该**允许用户点击点赞按钮执行点赞操作
- **AC 2.2**：当点赞操作成功时，系统**应该**：
  - 更新点赞按钮为已点赞状态（填充图标）
  - 点赞数量+1
  - 显示居中弹窗提示"点赞成功"
- **AC 2.3**：当用户再次点击已点赞按钮时，系统**应该**取消点赞并恢复未点赞状态
- **AC 2.4**：如果用户未登录，当用户点击点赞按钮时，系统**应该**显示"请先登录"提示
- **AC 2.5**：当点赞API请求失败时，系统**应该**显示错误信息并保持原有状态
- **AC 2.6**：当视频详情页加载时，系统**应该**检查用户是否已点赞并显示正确状态

---

### 3. 投币功能

**用户故事**：作为用户，我想要给喜欢的视频投硬币，以便支持UP主的创作。

**验收标准**：

- **AC 3.1**：当用户已登录时，系统**应该**允许用户点击投币按钮打开投币选择界面
- **AC 3.2**：当投币选择界面打开时，系统**应该**显示：
  - 投1个硬币选项
  - 投2个硬币选项
  - 用户当前硬币余额
  - "同时点赞"复选框（默认勾选）
- **AC 3.3**：如果用户硬币余额不足，系统**应该**禁用对应选项并显示余额不足提示
- **AC 3.4**：当投币操作成功时，系统**应该**：
  - 更新投币按钮显示已投币数量
  - 显示居中弹窗提示"投币成功"
  - 如果勾选了"同时点赞"，同步更新点赞状态
- **AC 3.5**：当用户已对该视频投满2个硬币时，系统**应该**禁用投币按钮并显示"已投满"
- **AC 3.6**：如果用户未登录，当用户点击投币按钮时，系统**应该**显示"请先登录"提示
- **AC 3.7**：当投币API请求失败时，系统**应该**显示错误信息

---

### 4. 一键三连功能

**用户故事**：作为用户，我想要通过一键三连快速完成点赞、投币和收藏操作，以便高效支持喜欢的视频。

**验收标准**：

- **AC 4.1**：当用户已登录时，系统**应该**在操作按钮区域显示"三连"按钮
- **AC 4.2**：当用户点击三连按钮时，系统**应该**依次执行：
  - 点赞（如果尚未点赞）
  - 投币2个（如果余额足够且未投满）
  - 收藏到默认收藏夹（如果尚未收藏）
- **AC 4.3**：当三连操作执行时，系统**应该**显示执行进度动画
- **AC 4.4**：当三连操作全部成功时，系统**应该**：
  - 更新所有相关按钮状态
  - 显示居中弹窗提示"三连成功"（或显示部分成功的详情）
- **AC 4.5**：如果三连过程中某项操作失败或条件不满足，系统**应该**：
  - 继续执行其他可执行的操作
  - 在完成后显示执行结果详情（如"点赞成功，投币失败：余额不足，收藏成功"）
- **AC 4.6**：如果用户已完成三连（已点赞+投满2币+已收藏），系统**应该**显示已三连状态
- **AC 4.7**：如果用户未登录，当用户点击三连按钮时，系统**应该**显示"请先登录"提示

---

## 技术约束

1. 所有操作需要CSRF Token（bili_jct）
2. 点赞接口：`POST x/web-interface/archive/like`
3. 投币接口：`POST x/web-interface/coin/add`
4. 需要检查用户登录状态
5. 操作反馈使用居中弹窗（与现有关注/收藏一致）

## 边缘情况

1. 网络断开时的操作处理
2. 用户快速连续点击的防抖处理
3. 视频被删除或下架时的错误处理
4. 用户硬币余额为0的提示

## 成功标准

1. 所有操作响应时间 < 2秒
2. 操作状态与B站Web端保持一致
3. 界面交互符合现有设计风格
