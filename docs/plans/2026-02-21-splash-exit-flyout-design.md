# Splash 退场「上飞+模糊」设计（冷启动每次触发）

## 背景与目标

用户目标：应用冷启动后，先看到启动图标，然后图标向上飞出并伴随模糊，最后自然进入应用内首页。

本设计限定：
- 触发时机：每次冷启动
- 目标页面：应用内首页（不是系统桌面）
- 动效风格：非线性曲线，观感顺滑
- 模糊范围：图标与背景一起模糊

## 现状（项目上下文）

- 启动入口在 `MainActivity.onCreate()`，使用 `installSplashScreen()`。
- 已有 `setKeepOnScreenCondition`：数据未就绪时最多停留 2500ms。
- minSdk=26，targetSdk=35，已引入 `androidx.core:core-splashscreen`。
- 当前还存在可选的自定义壁纸开屏遮罩层（Compose `AnimatedVisibility`）。

## 方案决策

### 备选方案

1. 系统 Splash 退场动画（推荐）
2. Compose 自定义假开屏遮罩
3. 混合方案（系统退场 + 首页轻微入场）

### 选型

采用方案 1：在系统 Splash 退出回调中直接执行动效。

选择原因：
- 与系统开屏衔接最自然，避免二次遮罩切换痕迹。
- 不增加额外等待时长，只替换退出阶段表现。
- 对现有启动预加载和超时逻辑侵入最小。

## 动画设计

### 动画目标

对 `setOnExitAnimationListener` 提供的 `provider.view` 执行单次退场动画。

### 参数（首版）

- 总时长：420ms
- 曲线：`PathInterpolator(0.22f, 1.0f, 0.36f, 1.0f)`
- 位移：`translationY` 从 `0` 到 `-96dp`
- 透明度：`alpha` 从 `1f` 到 `0f`
- 缩放：`scaleX/scaleY` 从 `1f` 到 `1.06f`
- 模糊：
  - API 31+：动态 blur，半径 `0f -> 22f`
  - API 26-30：降级为无真实 blur，仅位移+透明度+缩放

### 完成条件

- 动画结束后必须调用 `provider.remove()`。
- 任一异常路径必须兜底 `provider.remove()`，避免卡在开屏层。

## 架构与数据流

1. `installSplashScreen()` 安装系统开屏
2. `setKeepOnScreenCondition` 决定何时允许退场（已有逻辑保留）
3. 满足退出条件后触发 `setOnExitAnimationListener`
4. 在回调内执行属性动画（位移/透明/缩放/模糊）
5. 动画结束 `provider.remove()`，显示首页首帧

数据加载流不改：仍由现有首页预加载并行推进。

## 兼容与容错

- API 分层：
  - 31+ 启用实时模糊
  - 26-30 自动降级
- 失败兜底：
  - `runCatching` 包裹动画启动
  - 任何异常直接 `provider.remove()`
- 性能约束：
  - 不引入额外阻塞
  - 低版本不强行做重成本 blur

## 与现有自定义壁纸开屏关系

为避免“双重过渡”，首版建议：
- 使用本方案时，不叠加 2 秒自定义壁纸开屏遮罩。
- 若后续需要保留壁纸模式，可增加配置开关并定义互斥策略。

## 测试与验收

### 功能验收

- 冷启动每次都出现「上飞+模糊+淡出」。
- 动画结束后稳定进入首页，无残留遮罩。
- Deep link/快捷入口启动不受影响。

### 兼容验收

- Android 12+：可见真实模糊。
- Android 8-11：降级表现正常，无崩溃。

### 体验验收

- 无明显闪白/黑帧。
- 启动总耗时无显著增加（仅退出阶段视觉变化）。

## 风险与回滚

- 风险：低端机上动画掉帧。
- 缓解：保留降级路径，并可把 blur 半径作为可调常量。
- 回滚：移除 `setOnExitAnimationListener` 即回到系统默认退场。

## 非目标（本次不做）

- 不新增首页入场二段动画。
- 不在本次实现中同时支持壁纸开屏与飞出动效叠加。
- 不改动首页业务加载逻辑。
